#shared:
#    image: node:6
#jobs:
#    # the main job is run in pull requests as well
#    main:
#        steps: 
#            - install: npm install screwdriver-template-main
#            - validate: ./node_modules/.bin/template-validate
#            - publish: ./node_modules/.bin/template-publish
#    tag:
#        steps:
#            - install: npm install screwdriver-template-main
#            - token: echo $SD_TOKEN
#            - tag: ./node_modules/.bin/template-tag --name tifftemplate --version 1.0.4 --tag latest
#    use-tag:
#        template: tifftemplate@latest
---
jobs:
    main:
        requires: [~pr, ~commit]
        image: node:8
        steps:
            #- set: meta set build_version_1 1234567
            #- get: meta get build_version_1
            #- sleep: sleep 1500
            - meta1: |
                NPM_PKG_VERSION=meow
                meta set docker_tag "v$NPM_PKG_VERSION"
                echo `meta get docker_tag`
            - write5: echo "meow" > $SD_ARTIFACTS_DIR/zzz.txt
            - meta: meta get meow
            #- meow: meta set foo.bar-baz meow
            #- meow2: meta get foo.bar-baz
            - echo: meta set example.coverage 99.95
            #- publish: npx semantic-release
            #- install: npm install screwdriver-template-main
            #- tag: ./node_modules/.bin/template-tag --name tifftemplate --version 1.0.4 --tag meow
    set-key1:
        requires: [main]
        image: node:8
        steps:
            - test: meta set prefix.key1 value1
    set-key2:
        requires: [main]
        image: node:8
        steps:
            - test: meta set prefix.key2 value2
            - get: meta get prefix.key2
    get:
        requires: [set-key1, set-key2]
        image: node:8
        steps:
            - get1: echo "prefix.key1=$(meta get prefix.key1)"
            - get2: echo "prefix.key2=$(meta get prefix.key2)"
            - getget: meta get prefix.key2
    detached:
        image: node:8
        steps:
            - hi: echo hi
            - meta: meta get example
